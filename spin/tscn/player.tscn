[gd_scene load_steps=11 format=3 uid="uid://0dtxqoytg0r7"]

[ext_resource type="Texture2D" uid="uid://dllwvhhknfipu" path="res://good dagger straight.png" id="1_leyt2"]
[ext_resource type="Texture2D" uid="uid://bj2114s85mlxf" path="res://arm placeholder - Copy.png" id="2_h0km1"]

[sub_resource type="GDScript" id="GDScript_je7ld"]
script/source = "extends CharacterBody2D

@export var mult : float
@export var baseDam := 5.0
"

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_wxms7"]

[sub_resource type="GDScript" id="GDScript_glkjn"]
script/source = "extends Sprite2D

@export var arm : Sprite2D
@export var debug : Sprite2D
@export var player : CharacterBody2D
@export var radius := 50.0
@onready var prevPos : Vector2

func _physics_process(delta: float) -> void:
	position = Vector2(arm.position.x+radius*cos(arm.rotation), arm.position.y+radius*sin(arm.rotation))
	rotation = arm.rotation

func _on_velocity_sim_timeout() -> void:
	prevPos = position
	debug.position = prevPos
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_mks8s"]
size = Vector2(67, 20)

[sub_resource type="GDScript" id="GDScript_pmd5a"]
script/source = "extends Sprite2D

#@export var arm : Node2D
@export var angular_velocity : float = TAU * 2
@export var max_speed := 2.0
@export var deceleration := 0.8
@export var acceleration := 1.01
@export var slide := 0.08
var direction = 0
var theta = 0
var prev_theta = 0
var run_rotate = false

func _physics_process(delta: float) -> void:
	if run_rotate:
		direction = clamp(direction+slide, -1, 1)
	if (Input.is_action_just_pressed(\"dbg_downward\") or Input.is_action_just_pressed(\"dbg_upward\")) and angular_velocity <= 0.1:
		angular_velocity = 0.1
	if run_rotate or Input.is_action_pressed(\"dbg_downward\") or Input.is_action_pressed(\"dbg_upward\"):
		angular_velocity = clamp(angular_velocity*acceleration, 0, max_speed)
	else:
		angular_velocity = clamp(angular_velocity*deceleration, 0, max_speed)
	rotation += (angular_velocity*delta) * direction

func _unhandled_input(event: InputEvent) -> void:
	if event is InputEventMouseButton:
		if event.button_index == MOUSE_BUTTON_WHEEL_UP and $scrollDelay.is_stopped():
			slide *= -1
			run_rotate = true
			$scrollDelay.start()
		elif event.button_index == MOUSE_BUTTON_WHEEL_DOWN and $scrollDelay.is_stopped():
			slide = absf(slide)
			run_rotate = true
			$scrollDelay.start()

func _on_velocity_sim_timeout() -> void:
	prev_theta = rotation

func _on_scroll_delay_timeout() -> void:
	run_rotate = false
"

[sub_resource type="GDScript" id="GDScript_rcyof"]
script/source = "extends Line2D

func _process(delta: float) -> void:
	var mpos = get_local_mouse_position()
	set_point_position(1,mpos)
	#print(mpos)
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_vyjs5"]
size = Vector2(82, 86)

[sub_resource type="PlaceholderTexture2D" id="PlaceholderTexture2D_kpbnw"]

[node name="CharacterBody2D" type="CharacterBody2D"]
slide_on_ceiling = false
script = SubResource("GDScript_je7ld")

[node name="Sprites" type="Node2D" parent="."]

[node name="Player" type="Sprite2D" parent="Sprites"]
position = Vector2(22.5, -46.25)
scale = Vector2(80.952, 87)
texture = SubResource("PlaceholderTexture2D_wxms7")

[node name="OnHand" type="Sprite2D" parent="Sprites" node_paths=PackedStringArray("arm", "debug", "player")]
position = Vector2(70, -44)
texture = ExtResource("1_leyt2")
offset = Vector2(44, 2)
script = SubResource("GDScript_glkjn")
arm = NodePath("../ArmPlaceholder")
debug = NodePath("../../debug")
player = NodePath("../..")

[node name="hitrange" type="Area2D" parent="Sprites/OnHand"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Sprites/OnHand/hitrange"]
position = Vector2(53.5, 0)
shape = SubResource("RectangleShape2D_mks8s")

[node name="velocitySim" type="Timer" parent="Sprites/OnHand"]
wait_time = 0.06
autostart = true

[node name="ArmPlaceholder" type="Sprite2D" parent="Sprites"]
position = Vector2(21, -44)
texture = ExtResource("2_h0km1")
offset = Vector2(13, 0)
script = SubResource("GDScript_pmd5a")
angular_velocity = 10.0
max_speed = 16.0
deceleration = 0.9
acceleration = 1.102

[node name="Line2D" type="Line2D" parent="Sprites/ArmPlaceholder"]
visible = false
position = Vector2(-26, 42)
points = PackedVector2Array(23, -42, 427, -112)
script = SubResource("GDScript_rcyof")

[node name="scrollDelay" type="Timer" parent="Sprites/ArmPlaceholder"]
wait_time = 0.5
one_shot = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
visible = false
position = Vector2(22, -46)
shape = SubResource("RectangleShape2D_vyjs5")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="debug" type="Sprite2D" parent="."]
visible = false
position = Vector2(174, -122)
scale = Vector2(30.75, 21.5)
texture = SubResource("PlaceholderTexture2D_kpbnw")

[connection signal="timeout" from="Sprites/OnHand/velocitySim" to="Sprites/OnHand" method="_on_velocity_sim_timeout"]
[connection signal="timeout" from="Sprites/OnHand/velocitySim" to="Sprites/ArmPlaceholder" method="_on_velocity_sim_timeout"]
[connection signal="timeout" from="Sprites/ArmPlaceholder/scrollDelay" to="Sprites/ArmPlaceholder" method="_on_scroll_delay_timeout"]
